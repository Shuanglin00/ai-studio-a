# 配置管理

<cite>
**Referenced Files in This Document**   
- [ai/src/main/resources/application.yaml](file://ai/src/main/resources/application.yaml)
- [bot/src/main/resources/application.yaml](file://bot/src/main/resources/application.yaml)
- [ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/GeminiProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/GeminiProperties.java)
- [ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/MilvusProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/MilvusProperties.java)
- [ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/OllamaProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/OllamaProperties.java)
- [ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/QwenProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/QwenProperties.java)
- [ai/src/main/java/com/shuanglin/bot/langchain4j/config/ApiModelsConfiguration.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/ApiModelsConfiguration.java)
- [ai/src/main/java/com/shuanglin/bot/langchain4j/config/DocumentInitializer.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/DocumentInitializer.java)
- [ai/src/main/java/com/shuanglin/bot/langchain4j/rag/embedding/model/EmbeddingConfig.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/rag/embedding/model/EmbeddingConfig.java)
</cite>

## 目录
1. [简介](#简介)
2. [配置文件层次结构与Spring Profile](#配置文件层次结构与spring-profile)
3. [AI模块配置项详解](#ai模块配置项详解)
4. [Bot模块配置项详解](#bot模块配置项详解)
5. [配置项列表](#配置项列表)
6. [部署环境配置指南](#部署环境配置指南)
7. [安全注意事项](#安全注意事项)

## 简介
本文档旨在为 `ai` 和 `bot` 模块提供一份权威的配置管理参考。通过深入分析 `application.yaml` 文件及其关联的Java配置类，本文将详细解释每个配置项的作用、默认值、有效范围以及安全实践。文档还将阐述配置文件的层次结构和Spring Profile的使用方法，为开发者提供在不同部署环境（开发、测试、生产）下进行配置的指导。

## 配置文件层次结构与Spring Profile
本项目采用Spring Boot的标准配置管理机制。`ai` 和 `bot` 两个模块各自拥有独立的 `application.yaml` 配置文件，位于 `src/main/resources` 目录下。这些文件定义了应用运行所需的核心参数，如服务器端口、数据库连接、AI模型密钥等。

Spring Profile机制允许根据不同的运行环境加载不同的配置。虽然当前提供的 `application.yaml` 文件中未显式定义Profile（如 `application-dev.yaml`, `application-prod.yaml`），但其结构支持通过命令行参数（如 `--spring.profiles.active=dev`）或环境变量来激活特定的Profile配置文件。这为在开发、测试和生产环境中使用不同的数据库地址、API密钥等提供了灵活性。

## AI模块配置项详解
`ai` 模块的 `application.yaml` 文件主要配置了与AI模型、数据库和向量存储相关的参数。

### langchain4j.gemini 配置
该配置块用于初始化Google Gemini AI模型。
- **作用**: 配置Gemini模型的API密钥、模型名称、生成参数等。
- **默认值**: `apiKey` 为 `AIzaSyDf8AumGRKxpZwWGVTYsr3hlxeXZPQ9quQ`，`modelName` 为 `gemini-2.0-flash`，`temperature` 为 `0.7`。
- **有效范围**: 由 `GeminiProperties` Java类定义，并通过 `@ConfigurationProperties` 注解绑定到 `langchain4j.models.gemini` 前缀。在 `ApiModelsConfiguration` 类中被注入并用于创建 `GoogleAiGeminiChatModel` Bean。
- **关联文件**: [GeminiProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/GeminiProperties.java), [ApiModelsConfiguration.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/ApiModelsConfiguration.java)

### langchain4j.qwen 配置
该配置块用于初始化通义千问（Qwen）嵌入模型。
- **作用**: 配置Qwen模型的API密钥、模型名称等。
- **默认值**: `apiKey` 为 `sk-ef837a5f684c4ed087802c948857df5f`，`location` 为 `us-central1`，`modelName` 为 `text-embedding-v2`。
- **有效范围**: 由 `QwenProperties` Java类定义，并通过 `@ConfigurationProperties` 注解绑定到 `langchain4j.models.qwen` 前缀。在 `EmbeddingConfig` 类中被注入并用于创建 `QwenEmbeddingModel` Bean。
- **关联文件**: [QwenProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/QwenProperties.java), [EmbeddingConfig.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/rag/embedding/model/EmbeddingConfig.java)

### langchain4j.ollama 配置
该配置块用于配置Ollama本地模型服务。
- **作用**: 指定Ollama服务的URL、使用的模型名称和生成温度。
- **默认值**: `url` 为 `http://8.138.204.38:11434`，`modelName` 为 `gemma3:12b`，`temperature` 为 `0.8`。
- **有效范围**: 由 `OllamaProperties` Java类定义，并通过 `@ConfigurationProperties` 注解绑定到 `langchain4j.models.ollama` 前缀。在 `ApiModelsConfiguration` 类中被注入并用于创建 `OllamaChatModel` 和 `OllamaStreamingChatModel` Bean。
- **关联文件**: [OllamaProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/OllamaProperties.java), [ApiModelsConfiguration.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/ApiModelsConfiguration.java)

### milvus 配置
该配置块用于配置Milvus向量数据库。
- **作用**: 定义Milvus服务的连接信息、默认数据库和集合名称。
- **默认值**: `uri` 为 `http://8.138.204.38:19530`，`defaultDatabaseName` 为 `milvusDB`，`defaultCollectionName` 为 `novelCollection`。
- **有效范围**: 由 `MilvusProperties` Java类定义，并通过 `@ConfigurationProperties` 注解绑定到 `milvus` 前缀。该类被 `DocumentInitializer` 等多个组件注入，用于执行向量数据的插入和检索操作。
- **关联文件**: [MilvusProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/MilvusProperties.java), [DocumentInitializer.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/DocumentInitializer.java)

### spring.data.mongodb 配置
该配置块用于配置MongoDB文档数据库。
- **作用**: 提供MongoDB的连接地址、端口、数据库名、用户名和密码。
- **默认值**: `host` 为 `8.138.204.38`，`port` 为 `27017`，`database` 为 `storeDB`，`username` 为 `root`，`password` 为 `example`。
- **有效范围**: 由Spring Data MongoDB自动处理，用于建立与MongoDB的连接。
- **关联文件**: [application.yaml](file://ai/src/main/resources/application.yaml)

**Section sources**
- [application.yaml](file://ai/src/main/resources/application.yaml#L1-L57)
- [GeminiProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/GeminiProperties.java#L1-L35)
- [QwenProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/QwenProperties.java#L1-L34)
- [OllamaProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/OllamaProperties.java#L1-L34)
- [MilvusProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/MilvusProperties.java#L1-L32)

## Bot模块配置项详解
`bot` 模块的 `application.yaml` 文件与 `ai` 模块类似，但针对其运行环境配置了不同的数据库和向量存储地址。

### langchain4j.gemini 配置
- **作用**: 与AI模块相同，用于配置Gemini模型。
- **默认值**: 与AI模块完全相同。
- **有效范围**: 同AI模块。
- **关联文件**: [GeminiProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/GeminiProperties.java)

### langchain4j.qwen 配置
- **作用**: 与AI模块相同，用于配置Qwen模型。
- **默认值**: 与AI模块完全相同。
- **有效范围**: 同AI模块。
- **关联文件**: [QwenProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/QwenProperties.java)

### langchain4j.ollama 配置
- **作用**: 与AI模块相同，用于配置Ollama服务。
- **默认值**: `url` 为 `http://8.138.204.38:11434`，与AI模块相同。
- **有效范围**: 同AI模块。
- **关联文件**: [OllamaProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/OllamaProperties.java)

### milvus 配置
- **作用**: 与AI模块相同，用于配置Milvus向量数据库。
- **默认值**: `url` 为 `http://172.18.32.160:19530`，`defaultDatabaseName` 为 `chatEmbeddingDB6`，`messageCollectionName` 为 `message_embedding`。这表明Bot模块连接的是一个不同的Milvus实例和数据库。
- **有效范围**: 同AI模块。
- **关联文件**: [MilvusProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/MilvusProperties.java)

### spring.data.mongodb 配置
- **作用**: 与AI模块相同，用于配置MongoDB。
- **默认值**: `host` 为 `172.18.32.160`，`database` 为 `chatDB`，`username` 为 `'shuanglin'`，`password` 为 `'123456'`。这表明Bot模块使用独立的MongoDB实例和数据库。
- **有效范围**: 同AI模块。
- **关联文件**: [application.yaml](file://bot/src/main/resources/application.yaml)

**Section sources**
- [application.yaml](file://bot/src/main/resources/application.yaml#L1-L54)
- [GeminiProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/GeminiProperties.java#L1-L35)
- [QwenProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/QwenProperties.java#L1-L34)
- [OllamaProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/OllamaProperties.java#L1-L34)
- [MilvusProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/MilvusProperties.java#L1-L32)

## 配置项列表
下表汇总了 `ai` 和 `bot` 模块中所有关键的配置项。

| 配置项 | 作用 | 默认值 (AI模块) | 默认值 (Bot模块) | 有效范围 |
| :--- | :--- | :--- | :--- | :--- |
| `langchain4j.models.gemini.apiKey` | Gemini模型API密钥 | `AIzaSyDf8Aum...` | `AIzaSyDf8Aum...` | `GeminiProperties` |
| `langchain4j.models.gemini.modelName` | Gemini模型名称 | `gemini-2.0-flash` | `gemini-2.0-flash` | `GeminiProperties` |
| `langchain4j.models.gemini.temperature` | Gemini模型生成温度 | `0.7` | `0.7` | `GeminiProperties` |
| `langchain4j.models.qwen.apiKey` | Qwen模型API密钥 | `sk-ef837a5f...` | `sk-ef837a5f...` | `QwenProperties` |
| `langchain4j.models.qwen.location` | Qwen模型位置 | `us-central1` | `us-central1` | `QwenProperties` |
| `langchain4j.models.qwen.modelName` | Qwen模型名称 | `text-embedding-v2` | `text-embedding-v2` | `QwenProperties` |
| `langchain4j.models.ollama.url` | Ollama服务地址 | `http://8.138.204.38:11434` | `http://8.138.204.38:11434` | `OllamaProperties` |
| `langchain4j.models.ollama.modelName` | Ollama模型名称 | `gemma3:12b` | `gemma3:12b` | `OllamaProperties` |
| `langchain4j.models.ollama.temperature` | Ollama模型生成温度 | `0.8` | `0.8` | `OllamaProperties` |
| `milvus.uri` | Milvus服务地址 | `http://8.138.204.38:19530` | `http://172.18.32.160:19530` | `MilvusProperties` |
| `milvus.defaultDatabaseName` | Milvus默认数据库名 | `milvusDB` | `chatEmbeddingDB6` | `MilvusProperties` |
| `milvus.defaultCollectionName` / `milvus.messageCollectionName` | Milvus向量集合名 | `novelCollection` | `message_embedding` | `MilvusProperties` |
| `spring.data.mongodb.host` | MongoDB主机地址 | `8.138.204.38` | `172.18.32.160` | Spring Data MongoDB |
| `spring.data.mongodb.port` | MongoDB端口 | `27017` | `27017` | Spring Data MongoDB |
| `spring.data.mongodb.database` | MongoDB数据库名 | `storeDB` | `chatDB` | Spring Data MongoDB |
| `spring.data.mongodb.username` | MongoDB用户名 | `root` | `shuanglin` | Spring Data MongoDB |
| `spring.data.mongodb.password` | MongoDB密码 | `example` | `123456` | Spring Data MongoDB |

## 部署环境配置指南
为了在不同环境中安全、高效地部署应用，请遵循以下指南：
1.  **创建Profile特定文件**: 为每个环境创建独立的配置文件，例如 `application-dev.yaml`, `application-test.yaml`, `application-prod.yaml`。
2.  **环境隔离**: 确保开发、测试和生产环境使用完全独立的数据库（MongoDB, Milvus）实例，避免数据污染。
3.  **配置覆盖**: 在Profile文件中，仅覆盖与默认配置（`application.yaml`）不同的项。例如，在 `application-prod.yaml` 中只定义生产环境的数据库地址和经过严格管理的API密钥。
4.  **激活Profile**: 通过设置环境变量 `SPRING_PROFILES_ACTIVE=prod` 或启动参数 `--spring.profiles.active=prod` 来激活生产环境配置。

## 安全注意事项
1.  **API密钥管理**: `langchain4j.gemini.apiKey` 和 `langchain4j.qwen.apiKey` 是敏感信息，**绝不应硬编码在 `application.yaml` 文件中提交到版本控制系统**。应使用环境变量（如 `apiKey: ${GEMINI_API_KEY}`）或Spring Cloud Config等外部化配置中心来管理。
2.  **数据库凭证**: `spring.data.mongodb.username` 和 `password` 同样属于敏感信息，应遵循与API密钥相同的外部化管理原则。
3.  **访问控制**: 确保数据库和AI服务的访问受到网络防火墙和身份验证机制的保护，仅允许必要的服务访问。
4.  **定期轮换**: 定期轮换API密钥和数据库密码，以降低泄露风险。

**Section sources**
- [application.yaml](file://ai/src/main/resources/application.yaml#L1-L57)
- [application.yaml](file://bot/src/main/resources/application.yaml#L1-L54)
- [GeminiProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/GeminiProperties.java#L1-L35)
- [QwenProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/QwenProperties.java#L1-L34)
- [OllamaProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/OllamaProperties.java#L1-L34)
- [MilvusProperties.java](file://ai/src/main/java/com/shuanglin/bot/langchain4j/config/vo/MilvusProperties.java#L1-L32)