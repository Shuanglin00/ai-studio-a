# 部署与运维

<cite>
**本文档引用的文件**
- [pom.xml](file://pom.xml)
- [ai/pom.xml](file://ai/pom.xml)
- [bot/pom.xml](file://bot/pom.xml)
- [ai/src/main/resources/application.yaml](file://ai/src/main/resources/application.yaml)
- [bot/src/main/resources/application.yaml](file://bot/src/main/resources/application.yaml)
- [ai/src/main/java/com/shuanglin/ChatStart.java](file://ai/src/main/java/com/shuanglin/ChatStart.java)
- [bot/src/main/java/com/shuanglin/BotStart.java](file://bot/src/main/java/com/shuanglin/BotStart.java)
</cite>

## 目录
1. [构建项目](#构建项目)
2. [运行应用](#运行应用)
3. [配置管理](#配置管理)
4. [日志与监控](#日志与监控)
5. [容器化部署建议](#容器化部署建议)

## 构建项目

本项目采用Maven作为构建工具。项目根目录下的`pom.xml`文件定义了一个多模块Maven项目，包含`ai`、`bot`、`dbModel`和`common`等子模块。为了构建整个项目并生成可执行的JAR文件，应在项目根目录下执行Maven命令。

首先，清理旧的构建产物并编译、测试、打包所有模块。此命令会递归地处理所有子模块。

**Section sources**
- [pom.xml](file://pom.xml#L1-L97)
- [ai/pom.xml](file://ai/pom.xml#L1-L130)
- [bot/pom.xml](file://bot/pom.xml#L1-L34)

## 运行应用

项目包含两个主要的Spring Boot应用：`ai`模块和`bot`模块，它们分别由`ChatStart`和`BotStart`类作为启动入口。构建成功后，可以在各自模块的`target`目录下找到生成的JAR文件（例如`ai-1.0.jar`和`bot-1.0.jar`）。

要运行应用，使用标准的`java -jar`命令。例如，运行`ai`模块的命令如下：
`java -jar ai/target/ai-1.0.jar`

值得注意的是，`BotStart`类的`main`方法中包含了设置JVM代理的代码，这表明应用可能需要通过代理访问外部API（如Gemini）。在生产环境中，如果需要代理，应通过JVM参数或环境变量来配置，而不是硬编码在代码中。

**Section sources**
- [ai/src/main/java/com/shuanglin/ChatStart.java](file://ai/src/main/java/com/shuanglin/ChatStart.java#L6-L22)
- [bot/src/main/java/com/shuanglin/BotStart.java](file://bot/src/main/java/com/shuanglin/BotStart.java#L5-L21)

## 配置管理

项目的配置主要通过`application.yaml`文件进行管理，该文件位于各个模块的`src/main/resources`目录下。分析配置文件发现，其中包含了大量的敏感信息，如数据库密码、API密钥和服务器地址。

例如，`ai`模块的配置文件中直接包含了MongoDB的密码`example`和Neo4j的密码`password`，以及Gemini和Qwen的API密钥。这种做法存在严重的安全风险。

最佳实践是使用环境变量来替代配置文件中的硬编码值。Spring Boot天然支持通过环境变量覆盖`application.yaml`中的配置。例如，可以将`spring.data.mongodb.password`配置项的值从`example`改为`${MONGODB_PASSWORD}`，然后在运行JAR包时通过命令行设置环境变量：
`MONGODB_PASSWORD=my_secure_password java -jar ai-1.0.jar`

这样，敏感信息就不会暴露在代码仓库中，提高了应用的安全性。

**Section sources**
- [ai/src/main/resources/application.yaml](file://ai/src/main/resources/application.yaml#L1-L58)
- [bot/src/main/resources/application.yaml](file://bot/src/main/resources/application.yaml#L1-L55)

## 日志与监控

本项目未提供具体的日志轮转或监控配置。作为运维建议，应实施以下策略：

1.  **日志轮转**：使用`logback-spring.xml`或`log4j2.xml`等日志框架的配置文件来定义日志轮转策略。可以按文件大小或时间（如每天）进行轮转，并设置保留的日志文件数量，以防止磁盘空间被耗尽。
2.  **监控**：对于Spring Boot应用，应集成Actuator模块以暴露监控端点。通过这些端点，可以观察JVM的内存使用、线程状态、垃圾回收情况等关键指标。同时，应使用APM（应用性能管理）工具或自定义的监控代码来跟踪核心API的响应时间，以便及时发现性能瓶颈。

**Section sources**
- [pom.xml](file://pom.xml#L50-L52)

## 容器化部署建议

尽管项目中未提供Dockerfile，但容器化部署是现代应用部署的最佳实践。建议为每个模块（如`ai`和`bot`）创建独立的Docker镜像。

一个典型的Dockerfile可以基于`openjdk:17-jre-slim`镜像，将构建好的JAR文件复制到镜像中，并使用`ENTRYPOINT ["java", "-jar", "/app.jar"]`来启动应用。通过Docker Compose或Kubernetes，可以方便地管理应用及其依赖的服务（如Redis、MongoDB、Milvus），并实现环境的一致性、可扩展性和高可用性。

**Section sources**
- [pom.xml](file://pom.xml#L1-L97)